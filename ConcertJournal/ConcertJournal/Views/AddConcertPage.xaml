<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ConcertJournal.Views.AddConcertPage"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:material="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/material"
             xmlns:controls="clr-namespace:ConcertJournal.Views.Controls"
             xmlns:vm="clr-namespace:ConcertJournal.ViewModels"
             x:DataType="vm:AddConcertViewModel"
             Shell.NavBarIsVisible="False"
             BackgroundColor="{DynamicResource Background}">
    
    <ContentPage.Resources>
        <ResourceDictionary>
            <Style TargetType="material:TextField">
                <Setter Property="FontSize" Value="16" />
                <Setter Property="TextColor" Value="{DynamicResource TextColor}" />
                <Setter Property="AccentColor" Value="{DynamicResource InputAccent}" />
                <Setter Property="BackgroundColor" Value="Transparent" />
                <Setter Property="AllowClear" Value="True" />
                <Setter Property="BorderColor" Value="{DynamicResource CardBorder}" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*,Auto">

        <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto" Padding="15,10" BackgroundColor="{DynamicResource Surface}">
            <Button Grid.Column="0" Text="Cancel" Command="{Binding CancelCommand}" 
                    TextColor="{DynamicResource ButtonRed}" BackgroundColor="Transparent" FontSize="16"/>

            <Label Grid.Column="1" Text="{Binding PageTitle}" FontSize="20" FontAttributes="Bold" 
                   HorizontalOptions="Center" VerticalOptions="Center"/>

            <Button Grid.Column="2" Text="{Binding SaveButtonText}" Command="{Binding SaveCommand}"
                    BackgroundColor="{DynamicResource ButtonGreen}" CornerRadius="20" Padding="15,0" HeightRequest="40"/>
        </Grid>

        <ScrollView Grid.Row="1" VerticalScrollBarVisibility="Never">
            <VerticalStackLayout Padding="20" Spacing="20">

                <Border Padding="15" StrokeShape="RoundRectangle 12" BackgroundColor="{DynamicResource Surface}">
                    <VerticalStackLayout Spacing="15">
                        <material:TextField Title="Event Title" 
                                          Icon="{DynamicResource MusicIcon}"
                                          Text="{Binding EventTitle, Mode=TwoWay}" />

                        <VerticalStackLayout Spacing="10">
                            <material:TextField Title="Add Performer" 
                                              Text="{Binding PerformerInput, Mode=TwoWay}"
                                                TextColor="{DynamicResource TextColor}">
                                <material:TextField.Attachments>
                                    <Button Text="Add" Command="{Binding AddPerformerCommand}" 
                                            TextColor="{DynamicResource Primary}" 
                                            BackgroundColor="Transparent"
                                            BorderWidth="0"/>
                                </material:TextField.Attachments>
                            </material:TextField>

                            <FlexLayout BindableLayout.ItemsSource="{Binding Performers}" 
                                        Wrap="Wrap" Direction="Row" JustifyContent="Start">
                                <BindableLayout.ItemTemplate>
                                    <DataTemplate x:DataType="x:String">
                                        <Border Margin="2" Padding="10,5" StrokeShape="RoundRectangle 15" BackgroundColor="{DynamicResource Background}">
                                            <HorizontalStackLayout Spacing="5">
                                                <Label Text="{Binding .}" VerticalOptions="Center" FontSize="12"/>
                                                <ImageButton Source="{DynamicResource DeleteIcon}" HeightRequest="12"
                                                             WidthRequest="12"
                                                             Command="{Binding Source={RelativeSource AncestorType={x:Type vm:AddConcertViewModel}}, Path=RemovePerformerCommand}"
                                                             CommandParameter="{Binding .}"/>
                                            </HorizontalStackLayout>
                                        </Border>
                                    </DataTemplate>
                                </BindableLayout.ItemTemplate>
                            </FlexLayout>
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <Border Padding="15" StrokeShape="RoundRectangle 12" BackgroundColor="{DynamicResource Surface}">
                    <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*,*" RowSpacing="15" ColumnSpacing="10">
                        <material:TextField Grid.Row="0" Grid.ColumnSpan="2" Title="Venue" Text="{Binding Venue, Mode=TwoWay}"/>

                        <material:TextField Grid.Row="1" Grid.Column="0" Title="City" Text="{Binding City, Mode=TwoWay}"/>
                        <material:TextField Grid.Row="1" Grid.Column="1" Title="Country" Text="{Binding Country, Mode=TwoWay}"/>
                    </Grid>
                </Border>

                <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                    <Border Grid.Column="0" Padding="10" StrokeShape="RoundRectangle 12" BackgroundColor="{DynamicResource Surface}">
                        <VerticalStackLayout Spacing="5">
                            <Label Text="DATE" FontSize="10" FontAttributes="Bold" Opacity="0.6"/>
                            <DatePicker Date="{Binding Date, Mode=TwoWay}" BackgroundColor="Transparent"/>
                        </VerticalStackLayout>
                    </Border>

                    <Border Grid.Column="1" Padding="10" StrokeShape="RoundRectangle 12" BackgroundColor="{DynamicResource Surface}">
                        <VerticalStackLayout Spacing="5" HorizontalOptions="Center">
                            <Label Text="RATING" FontSize="10" FontAttributes="Bold" Opacity="0.6" HorizontalOptions="Center"/>
                            <toolkit:RatingView Rating="{Binding Rating, Mode=TwoWay}" ShapeDiameter="20" Spacing="3"/>
                        </VerticalStackLayout>
                    </Border>
                </Grid>

                <material:EditorField 
                    Title="Your Experience" 
                    Text="{Binding Notes, Mode=TwoWay}" 
                    HeightRequest="120"
                    TextColor="{DynamicResource TextColor}"/>

                <VerticalStackLayout Spacing="10">
                    <Grid ColumnDefinitions="*,Auto">
                        <Label Grid.Column="0" Text="Memories" FontSize="18" FontAttributes="Bold" VerticalOptions="Center"/>
                        <Button Grid.Column="1" Text="+ Photos" Command="{Binding AddImageCommand}" 
                                StyleClass="TextButton" TextColor="{DynamicResource Primary}"/>
                    </Grid>

                    <CollectionView ItemsSource="{Binding MediaFiles}" ItemsLayout="HorizontalList" HeightRequest="120">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="x:String">
                                <Grid Margin="0,0,10,0" WidthRequest="100">
                                    <Border StrokeShape="RoundRectangle 10" StrokeThickness="0">
                                        <Image Source="{Binding .}" Aspect="Fill"/>
                                    </Border>
                                    <ImageButton Source="{DynamicResource DeleteIcon}" 
                                                 BackgroundColor="#80000000"
                                                 CornerRadius="15"
                                                 HeightRequest="24" WidthRequest="24"
                                                 VerticalOptions="Start" HorizontalOptions="End"
                                                 Margin="4"
                                                 Command="{Binding Source={RelativeSource AncestorType={x:Type vm:AddConcertViewModel}}, Path=RemoveMediaCommand}"
                                                 CommandParameter="{Binding .}"/>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>

            </VerticalStackLayout>
        </ScrollView>

        <controls:BottomNavBar Grid.Row="2" ActiveRoute="AddConcertPage"/>
    </Grid>
</ContentPage>