<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ConcertJournal.Views.AddConcertPage"
             
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:material="clr-namespace:UraniumUI.Material.Controls;assembly=UraniumUI.Material"
             xmlns:controls="clr-namespace:ConcertJournal.Views.Controls"
             xmlns:models="clr-namespace:ConcertJournal.Models"
             
             x:DataType="models:Concert"
             Shell.NavBarIsVisible="False"
             BackgroundColor="{DynamicResource Background}">

    <!--For UraniumUI Material styles-->
    <ContentPage.Resources>
        <ResourceDictionary>
            <Style TargetType="material:TextField">
                <Setter Property="FontSize" Value="16" />
                <Setter Property="TextColor" Value="{DynamicResource TextColor}" />
                <Setter Property="AccentColor" Value="{DynamicResource InputAccent}" />
                <Setter Property="BackgroundColor" Value="Transparent" />
                <Setter Property="AllowClear" Value="True" />
                <Setter Property="BorderColor" Value="{DynamicResource CardBorder}" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="*,Auto">
        <ScrollView VerticalScrollBarVisibility="Never">

            <!--MainContent-->
            <Grid ColumnDefinitions="*,*,*" Padding="8">
                <VerticalStackLayout Grid.ColumnSpan="3">
                    
                    <!--PageTitle and Create button-->
                    <Grid>
                        <Button
                            x:Name="CancelButton"
                            Text="Cancel"
                            FontSize="18"
                            StyleClass="OutlinedButton"
                            BackgroundColor="Transparent"
                            BorderColor="{DynamicResource ButtonRed}"
                            TextColor="{DynamicResource ButtonRed}"
                            HorizontalOptions="Start"
                            Clicked="OnCancelButtonClicked"
                            IsVisible="false"/>

                        <Label 
                            Grid.Column="1"
                            x:Name="AddConcertPageTitle"
                            Text="Create Event"
                            FontSize="32"
                            FontAttributes="Bold"
                            HorizontalOptions="Center"/>
                        
                        <Button 
                            Grid.Column="1"
                            x:Name="SaveButton"
                            Text="Create"
                            FontSize="22"
                            Padding="8"
                            TextColor="{DynamicResource ButtonUpdateDeleteText}"
                            BackgroundColor="{DynamicResource ButtonGreen}"
                            HorizontalOptions="End"
                            Clicked="SaveButton_Clicked"
                            BorderWidth="0"/>
                    </Grid>

                    <!--Event Title-->
                    <Label 
                        Text="Event Title"
                        Margin="0,12,0,12"
                        FontSize="22"
                        FontAttributes="Bold"/>

                    <material:TextField 
                        x:Name="EventTitleEntry"
                        Title="Event Title"
                        CornerRadius="12"
                        Text="{Binding EventTitle}"/>

                    <!--Performer name--> 
                    <Label 
                        Grid.Row="0"
                        Grid.Column="0"
                        Text="Performer name" 
                        Margin="0,16,0,12"
                        FontSize="22"
                        FontAttributes="Bold"/>

                    <material:TextField 
                        Margin="0,0"
                        CornerRadius="12"
                        x:Name="PerformerEntry"
                        Title="Performer"
                        Text="{Binding Performer}"
                        ReturnType="Default"
                        Completed="AddNewPerformer">
                        <material:TextField.Attachments>
                            <Button 
                                Text="+ADD"
                                VerticalOptions="Center"
                                StyleClass="TextButton"
                                BackgroundColor="Transparent"
                                BorderWidth="0"
                                TextColor="{DynamicResource ButtonGreen}"
                                Padding="5"
                                Margin="0,0,16,0"
                                FontSize="18"
                                Clicked="AddNewPerformer"/>
                        </material:TextField.Attachments>
                    </material:TextField>

                    <!--CollectionView to show added performers-->
                    <CollectionView x:Name="PerformersList" ItemsSource="{Binding Performers}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="x:String">
                                <StackLayout Orientation="Horizontal" Spacing="4">
                                    <Label 
                                        Text="{Binding .}" 
                                        FontSize="16" 
                                        VerticalOptions="Center"
                                        Padding="8"/>

                                    <Button 
                                        Text="X"
                                        TextColor="{DynamicResource ButtonRed}"
                                        StyleClass="TextButton"
                                        FontSize="16"
                                        FontAttributes="Bold"
                                        BackgroundColor="Transparent"
                                        BorderWidth="0"
                                        Clicked="RemovePerformer"
                                        BindingContext="{Binding .}"/>
                                </StackLayout>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                    
                    <!--Venue-->
                    <Label 
                        Text="Venue" 
                        Margin="0,12,0,12"
                        FontSize="18"
                        FontAttributes="Bold"/>
                 
                    <material:TextField 
                        x:Name="VenueEntry"
                        Title="Venue" 
                        CornerRadius="12"
                        Text="{Binding Venue}"/>
                    
                    <!--Country & City-->
                    <Grid ColumnDefinitions="*,*"
                          RowDefinitions="*,*,*,*"
                          ColumnSpacing="8">
                        <Label Grid.Row="0"
                               Grid.Column="0"
                               Text="Country" 
                               Margin="0,12,0,12"
                               FontSize="18"
                               FontAttributes="Bold"/>
                        <material:TextField 
                            Grid.Row="1"
                            Grid.Column="0"
                            CornerRadius="12"
                            Title="Country"
                            x:Name="CountryEntry"
                            Text="{Binding Country}"/>

                        <Label 
                            Grid.Row="0"
                            Grid.Column="1"
                            Text="City" 
                            Margin="0,12,0,12"
                            FontSize="18"
                            FontAttributes="Bold"/>
                        <material:TextField 
                            Grid.Row="1"
                            Grid.Column="1"
                            Title="City"
                            CornerRadius="12"
                            x:Name="CityEntry"
                            Text="{Binding City}"
                            InputBackgroundColor="{DynamicResource ButtonBackground}"/>
                        
                        <!--Date-->
                        <Label 
                            Grid.Row="2"
                            Grid.Column="0"
                            Text="Date" 
                            Margin="0,12,0,12"
                            FontSize="18"
                            FontAttributes="Bold"/>
                        <Border 
                            Grid.Row="3"
                            Grid.Column="0"
                            HorizontalOptions="Start"
                            Stroke="{DynamicResource SurfaceDark}"
                            StrokeShape="RoundRectangle 16"
                            StrokeThickness="1">
                            <DatePicker x:Name="DatePicker"/>
                        </Border>

                        <!--Rating-->
                        <Label 
                            Grid.Row="2"
                            Grid.Column="1"
                            Margin="0,12,0,12"
                            Text="Rate event"
                            FontSize="18"
                            FontAttributes="Bold"/>
                        <toolkit:RatingView 
                            Grid.Row="3"
                            Grid.Column="1"
                            x:Name="ConcertRating"
                            EmptyShapeColor="Transparent"
			                FillColor="{DynamicResource RatingFill}"
			                FillOption ="Shape"
			                IsReadOnly="False"
			                ShapePadding="0"
			                ShapeDiameter="32"
			                MaximumRating="5"
			                Shape="Star"
			                ShapeBorderColor="{DynamicResource ButtonBorderColor}"
			                ShapeBorderThickness="1"
                            Rating="0"
			                Spacing="8"/>
                    </Grid> 
                    
                    <!--Notes-->
                    <Label 
                        Text="Notes" 
                        Margin="0,12,0,12"
                        FontSize="18"
                        FontAttributes="Bold"/>
                    
                    <material:EditorField
                        x:Name="NotesEditor"
                        Title="Add Notes"
                        CornerRadius="12"
                        Text="{Binding Notes}"
                        TextColor="{DynamicResource TextColor}"
                        BorderColor="{DynamicResource CardBorder}"
                        AccentColor="{DynamicResource InputAccent}"/>

                    <!--Media-->
                    <Label 
                        Text="Images/Videos"
                        Margin="0,12,0,12"
                        FontSize="18"
                        FontAttributes="Bold"/>
                    <!-- Upload Button -->
                    <Button 
                        Text="Upload Image(s)"
                        Clicked="OnAddImageClicked"
                        HorizontalOptions="Start"
                        StyleClass="FilledButton"
                        Margin="0,0,0,12"
                        BackgroundColor="{DynamicResource ButtonBackground}"
                        TextColor="{DynamicResource ButtonTextColor}"/>

                    <!-- Image Preview -->
                    <CollectionView x:Name="MediaCollectionView"
                                    ItemsSource="{Binding MediaFiles}"
                                    SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="x:String">
                                <Grid RowDefinitions="Auto,*">
                                    <Border Grid.Row="0"
                                            Padding="4"
                                            StrokeThickness="0"
                                            MaximumHeightRequest="500"
                                            MaximumWidthRequest="500">
                                        <Image Source="{Binding .}" 
                                               Aspect="AspectFit"/>
                                    </Border>

                                    <Button Grid.Row="1"
                                            Text="Remove image"
                                            TextColor="{DynamicResource White}"
                                            BackgroundColor="{DynamicResource ButtonRed}"
                                            FontSize="14"
                                            StyleClass="FilledButton"
                                            FontAttributes="Bold"
                                            Padding="4"
                                            Margin="0,0,0,20"
                                            MaximumWidthRequest="150"
                                            Clicked="OnRemoveMediaClicked"
                                            BindingContext="{Binding .}"/>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Grid>
        </ScrollView>

        <!--Navigation bar-->
        <controls:BottomNavBar Grid.Row="1" ActiveRoute="AddConcertPage"/>
    </Grid>
</ContentPage>