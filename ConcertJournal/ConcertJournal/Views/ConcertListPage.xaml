<?xml version="1.0" encoding="utf-8" ?>
<uranium:UraniumContentPage 
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ConcertJournal.Views.ConcertListPage"
             xmlns:uranium="http://schemas.enisn-projects.io/dotnet/maui/uraniumui"
             xmlns:input="clr-namespace:InputKit.Shared.Controls;assembly=InputKit.Maui"
             xmlns:material="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/material"
             xmlns:controls="clr-namespace:ConcertJournal.Views.Controls"
             xmlns:models="clr-namespace:ConcertJournal.Models"
             xmlns:vm="clr-namespace:ConcertJournal.ViewModels"
             x:DataType="vm:ConcertListViewModel"
             BackgroundColor="{DynamicResource Background}"
             Shell.NavBarIsVisible="False">

    <Grid RowDefinitions="*,Auto">
        <Grid RowDefinitions="Auto,*">
            <Grid ColumnDefinitions=".1*,.8*,.1*" RowDefinitions="*,*" BackgroundColor="{DynamicResource CardBackground}">

                <Label Grid.Column="1" Text="Event List" FontSize="32" FontAttributes="Bold" HorizontalOptions="Center"/>

                <Label Grid.Column="1" Grid.Row="1" 
                       Text="{Binding TotalConcertsText}" 
                       FontSize="14" HorizontalTextAlignment="Center" Margin="0,0,0,4"/>

                <ImageButton Grid.RowSpan="2" Grid.Column="2"
                             Source="{Binding FilterIcon}"
                             Command="{Binding ToggleFilterCommand}"
                             HorizontalOptions="End" Margin="0,0,12,0"/>
            </Grid>

            <CollectionView 
                Grid.Row="1" x:Name="ConcertListView" Margin="8"
                ItemsSource="{Binding Concerts}"
                SelectedItems="{Binding SelectedItems}"
                SelectionMode="Multiple"
                RemainingItemsThreshold="7"
                RemainingItemsThresholdReachedCommand="{Binding LoadMoreConcertsCommand}">

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Concert">
                        <Grid Margin="0,0,0,12">
                            <Border x:Name="CardBorder" Padding="12" StrokeShape="RoundRectangle 16" BackgroundColor="{DynamicResource CardBackground}">
                                <Grid RowDefinitions="*,*" ColumnDefinitions="*, Auto">
                                    <VerticalStackLayout HorizontalOptions="Center">
                                        <Label Text="{Binding EventTitle}" FontSize="24" FontAttributes="Bold"/>
                                    </VerticalStackLayout>
                                </Grid>
                            </Border>

                            <Button BackgroundColor="Transparent"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ConcertListViewModel}}, Path=CardClickedCommand}"
                                    CommandParameter="{Binding .}" />

                            <ImageButton Source="{DynamicResource ThreeDotsIcon}"
                                         Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ConcertListViewModel}}, Path=ShowOptionsCommand}"
                                         CommandParameter="{Binding .}"
                                         HorizontalOptions="End" VerticalOptions="End" Margin="16"/>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>

        <Grid ColumnDefinitions="*,*" 
              BackgroundColor="{DynamicResource Background}"
              IsVisible="{Binding HasSelection}"
              VerticalOptions="End" HeightRequest="64">

            <Button Grid.Column="1" Text="Delete selected" 
                    Command="{Binding DeleteSelectedAsyncCommand}"
                    TextColor="{DynamicResource ButtonRed}" BorderColor="{DynamicResource ButtonRed}" />

            <Button Grid.Column="0" Text="Unselect all" 
                    Command="{Binding UnselectAllCommand}"
                    TextColor="{DynamicResource ButtonGreen}" BorderColor="{DynamicResource ButtonGreen}" />
        </Grid>

        <controls:BottomNavBar Grid.Row="1" ActiveRoute="ConcertListPage"/>
    </Grid>

    <uranium:UraniumContentPage.Attachments>
        <material:BackdropView IsPresented="{Binding IsFilterPresented}" BackgroundColor="{DynamicResource PrimaryDark}">
            <VerticalStackLayout Spacing="32" Padding="8,16">

                <SearchBar Placeholder="Search..." 
                           Text="{Binding SearchText}"
                           SearchCommand="{Binding SearchAsyncCommand}"/>

                <input:RadioButtonGroupView SelectedItem="{Binding SelectedSort}">
                    <input:RadioButton Text="Default" Value="Default" />
                    <input:RadioButton Text="Newest By Date" Value="NewestByDate" />
                    <input:RadioButton Text="Oldest By Date" Value="OldestByDate" />
                </input:RadioButtonGroupView>

            </VerticalStackLayout>
        </material:BackdropView>
    </uranium:UraniumContentPage.Attachments>
</uranium:UraniumContentPage>