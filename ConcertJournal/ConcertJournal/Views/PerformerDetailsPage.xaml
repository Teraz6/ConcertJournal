<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ConcertJournal.Views.PerformerDetailsPage"
             xmlns:material="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/material"
             xmlns:controls="clr-namespace:ConcertJournal.Views.Controls"
             xmlns:models="clr-namespace:ConcertJournal.Models"
             xmlns:vm="clr-namespace:ConcertJournal.ViewModels"
             x:DataType="vm:PerformerDetailsViewModel"
             BackgroundColor="{DynamicResource Background}"
             Shell.NavBarIsVisible="False">
    
    <Grid RowDefinitions="*,Auto">
        <!--Main content-->
        <Grid
            Grid.Row="0"
            RowDefinitions="Auto,*">
            <Grid Grid.Row="0"
                  ColumnDefinitions=".1*,.8*,.1*"
                  BackgroundColor="{DynamicResource CardBackground}"
                  Padding="4">
                
                <ImageButton Source="{DynamicResource DoubleLeftArrowIcon}" Command="{Binding BackCommand}"/>
        
                <Label 
                    Grid.Column="1"
                    Text="{Binding PerformerName}"
                    FontAttributes="Bold"
                    FontSize="28" 
                    TextTransform="Uppercase"
                    HorizontalTextAlignment="Center" 
                    LineBreakMode="WordWrap"
                    Padding="0,8"/>
            </Grid>

            <Grid 
                Grid.Row="1"
                RowDefinitions="Auto,*"
                Padding="4">

                <!--Stats labels-->
                <VerticalStackLayout 
                    Grid.Row="0"
                    HorizontalOptions="Center">

                    <!--Stats title-->
                    <Label 
                        Grid.Row="0"
                        Text="Statistics"
                        FontAttributes="Bold"
                        TextDecorations="Underline"
                        FontSize="24" 
                        HorizontalOptions="Center"
                        Margin="4"/>

                    <Grid
                        RowDefinitions="*,*"
                        ColumnDefinitions="*,*">

                        <!-- Total Shows Seen -->
                        <Border
                            Grid.Row="0"
                            Grid.Column="0"
                            Padding="8">
                            <VerticalStackLayout>
                                <Label 
                                    FontSize="20"
                                    FontAttributes="Bold"
                                    Text="Total Shows Seen"
                                    HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding TimesSeen}" FontSize="32" FontAttributes="Bold" HorizontalTextAlignment="Center"/>
                            </VerticalStackLayout>
                        </Border>

                        <!-- Countries Seen In -->
                        <Border
                            Grid.Row="0"
                            Grid.Column="1"
                            Padding="8">
                            <VerticalStackLayout>
                                <Label
                                    FontSize="20"
                                    FontAttributes="Bold"
                                    Text="Countries Seen In"
                                    HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding CountriesSeen}" FontSize="32" FontAttributes="Bold" HorizontalTextAlignment="Center"/>
                            </VerticalStackLayout>
                        </Border>

                        <!-- First Show Attended -->
                        <Border
                            Grid.Row="1"
                            Grid.Column="0"
                            Padding="8">
                            <VerticalStackLayout>
                                <Label 
                                    FontSize="20"
                                    FontAttributes="Bold"
                                    Text="First Show Attended"
                                    HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding FirstSeen}" FontSize="20" FontAttributes="Bold" HorizontalTextAlignment="Center"/>
                            </VerticalStackLayout>
                        </Border>

                        <!-- Last Show Attended -->
                        <Border
                            Grid.Row="1"
                            Grid.Column="1"
                            Padding="8">
                            <VerticalStackLayout>
                                <Label 
                                    FontSize="20"
                                    FontAttributes="Bold"
                                    Text="Last Show Attended"
                                    HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding RecentSeen}" FontSize="20" FontAttributes="Bold" HorizontalTextAlignment="Center"/>
                            </VerticalStackLayout>
                        </Border>
                    </Grid>
                </VerticalStackLayout>

                <Grid 
                    Grid.Row="1"
                    RowDefinitions="Auto,*">
                    
                    <!--Concerts list-->
                    <Label 
                        Grid.Row="0"
                        Text="Concerts Attended"
                        FontAttributes="Bold"
                        TextDecorations="Underline"
                        FontSize="24" 
                        HorizontalOptions="Center"
                        Margin="4"/>
                    
                    <CollectionView
                        Grid.Row="1"
                        ItemsSource="{Binding Concerts}"
                        VerticalScrollBarVisibility="Never">
                        <CollectionView.ItemsLayout>
                            <GridItemsLayout Orientation="Vertical"
                                             Span="2"
                                             HorizontalItemSpacing="8"
                                             VerticalItemSpacing="8"/>
                        </CollectionView.ItemsLayout>
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:Concert">
                                <Border
                                    StrokeShape="RoundRectangle 16"
                                    Stroke="{DynamicResource CardBorder}">
                                    <Grid 
                                        ColumnDefinitions=".8*,.2*"
                                        RowDefinitions="*,*,*"
                                        Padding="8">

                                        <Label 
                                            Grid.Row="0"
                                            Grid.ColumnSpan="2"
                                            Text="{Binding EventTitle}" 
                                            FontAttributes="Bold" 
                                            FontSize="16"
                                            LineBreakMode="TailTruncation"/>

                                        <Label 
                                            Grid.Row="1"
                                            Grid.Column="0"
                                            Text="{Binding Location}" 
                                            FontSize="14"
                                            LineBreakMode="TailTruncation"
                                            VerticalTextAlignment="Center"/>

                                        <Label 
                                            Grid.Row="2"
                                            Grid.Column="0"
                                            Text="{Binding Date, StringFormat='{}{0:dd MMM yyyy}'}" 
                                            FontSize="12"
                                            VerticalTextAlignment="End"/>

                                        <ImageButton 
                                            Grid.Row="1"
                                            Grid.RowSpan="2"
                                            Grid.Column="1"
                                            Source="{DynamicResource DetailsIcon}"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type vm:PerformerDetailsViewModel}}, Path=GoToDetailsCommand}"
                                            CommandParameter="{Binding .}"
                                            HorizontalOptions="End"
                                            VerticalOptions="End"
                                            HeightRequest="48"
                                            WidthRequest="48"
                                            Padding="8"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </Grid>
            </Grid>
        </Grid>

        <!--Navigation bar-->
        <controls:BottomNavBar Grid.Row="2" />
    </Grid>
</ContentPage>