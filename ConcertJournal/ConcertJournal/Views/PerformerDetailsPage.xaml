<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ConcertJournal.Views.PerformerDetailsPage"
             xmlns:material="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/material"
             xmlns:controls="clr-namespace:ConcertJournal.Views.Controls"
             xmlns:models="clr-namespace:ConcertJournal.Models"
             xmlns:vm="clr-namespace:ConcertJournal.ViewModels"
             x:DataType="vm:PerformerDetailsViewModel"
             BackgroundColor="{DynamicResource Background}"
             Shell.NavBarIsVisible="False">

    <Grid RowDefinitions="*, Auto">
        <ScrollView Grid.Row="0">
            <VerticalStackLayout Spacing="0">

                <Grid HeightRequest="300">
                    
                    <!--Remove max height request if image is clipping out of the boxView-->
                    <Image Source="{Binding BackgroundImageUrl}"
                           Aspect="AspectFill"
                           HorizontalOptions="Fill"
                           VerticalOptions="Fill"
                           MaximumHeightRequest="400"/>

                    <BoxView VerticalOptions="Fill" HorizontalOptions="Fill">
                        <BoxView.Background>
                            <LinearGradientBrush EndPoint="0,1">
                                <GradientStop Color="Transparent" Offset="0.0" />
                                <GradientStop Color="{DynamicResource Background}" Offset="1.0" />
                            </LinearGradientBrush>
                        </BoxView.Background>
                    </BoxView>

                    <ImageButton Source="{DynamicResource DoubleLeftArrowIcon}" 
                                 Command="{Binding BackCommand}"
                                 HorizontalOptions="Start"
                                 VerticalOptions="Start"
                                 Margin="20,50"
                                 HeightRequest="40"
                                 WidthRequest="40"/>

                    <Label Text="{Binding PerformerName}"
                           FontSize="42"
                           FontAttributes="Bold"
                           TextColor="{DynamicResource Primary}"
                           VerticalOptions="End"
                           HorizontalOptions="Start"
                           Margin="20,0,20,20"
                           LineBreakMode="WordWrap"
                           CharacterSpacing="1.2"/>
                </Grid>

                <VerticalStackLayout Padding="20" Spacing="15">
                    <Label Text="JOURNEY STATS" 
                           FontSize="14" 
                           FontAttributes="Bold" 
                           TextColor="{DynamicResource Secondary}"
                           CharacterSpacing="2"
                           Margin="5,0"/>

                    <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="12">
                        <Border Grid.Row="0" Grid.Column="0" StrokeShape="RoundRectangle 12" BackgroundColor="{DynamicResource Surface}" Padding="15">
                            <VerticalStackLayout HorizontalOptions="Center">
                                <Label Text="Shows" FontSize="12" HorizontalOptions="Center" Opacity="0.7"/>
                                <Label Text="{Binding TimesSeen}" FontSize="28" FontAttributes="Bold" HorizontalOptions="Center" TextColor="{DynamicResource Primary}"/>
                            </VerticalStackLayout>
                        </Border>

                        <Border Grid.Row="0" Grid.Column="1" StrokeShape="RoundRectangle 12" BackgroundColor="{DynamicResource Surface}" Padding="15">
                            <VerticalStackLayout HorizontalOptions="Center">
                                <Label Text="Countries" FontSize="12" HorizontalOptions="Center" Opacity="0.7"/>
                                <Label Text="{Binding CountriesSeen}" FontSize="28" FontAttributes="Bold" HorizontalOptions="Center" TextColor="{DynamicResource Primary}"/>
                            </VerticalStackLayout>
                        </Border>

                        <Border Grid.Row="1" Grid.ColumnSpan="2" StrokeShape="RoundRectangle 12" BackgroundColor="{DynamicResource Surface}" Padding="15">
                            <Grid ColumnDefinitions="*,Auto">
                                <VerticalStackLayout>
                                    <Label Text="First Experience" FontSize="12" Opacity="0.7"/>
                                    <Label Text="{Binding FirstSeen}" FontSize="16" FontAttributes="Bold"/>
                                </VerticalStackLayout>
                                <VerticalStackLayout Grid.Column="1" HorizontalOptions="End">
                                    <Label Text="Most Recent" FontSize="12" Opacity="0.7" HorizontalOptions="End"/>
                                    <Label Text="{Binding RecentSeen}" FontSize="16" FontAttributes="Bold" HorizontalOptions="End"/>
                                </VerticalStackLayout>
                            </Grid>
                        </Border>
                    </Grid>
                </VerticalStackLayout>

                <VerticalStackLayout Padding="20" Spacing="15">
                    <Label Text="CONCERT HISTORY" 
                           FontSize="14" 
                           FontAttributes="Bold" 
                           TextColor="{DynamicResource Secondary}"
                           CharacterSpacing="2"
                           Margin="5,0"/>

                    <CollectionView ItemsSource="{Binding Concerts}"
                                    EmptyView="No concerts logged yet."
                                    SelectionMode="None">
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Vertical" ItemSpacing="12"/>
                        </CollectionView.ItemsLayout>
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:Concert">
                                <Border StrokeShape="RoundRectangle 16" 
                                        BackgroundColor="{DynamicResource Surface}"
                                        StrokeThickness="0">
                                    <Grid ColumnDefinitions="*, Auto" Padding="16">
                                        <VerticalStackLayout Grid.Column="0" Spacing="4">
                                            <Label Text="{Binding EventTitle}" 
                                                   FontAttributes="Bold" 
                                                   FontSize="18"
                                                   TextColor="{DynamicResource TextColor}"/>
                                            <Label Text="{Binding Location}" 
                                                   FontSize="14" 
                                                   Opacity="0.8"/>
                                            <Label Text="{Binding Date, StringFormat='{}{0:dd MMM yyyy}'}" 
                                                   FontSize="12" 
                                                   TextColor="{DynamicResource Secondary}"/>
                                        </VerticalStackLayout>

                                        <ImageButton Grid.Column="1"
                                                     Source="{DynamicResource DetailsIcon}"
                                                     Command="{Binding Source={RelativeSource AncestorType={x:Type vm:PerformerDetailsViewModel}}, Path=GoToDetailsCommand}"
                                                     CommandParameter="{Binding .}"
                                                     HeightRequest="35"
                                                     WidthRequest="35"
                                                     VerticalOptions="Center"
                                                     BackgroundColor="Transparent"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </VerticalStackLayout>
        </ScrollView>

        <controls:BottomNavBar Grid.Row="1" />
    </Grid>
</ContentPage>