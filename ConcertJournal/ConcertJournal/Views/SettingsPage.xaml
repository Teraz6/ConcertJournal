<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ConcertJournal.Views.SettingsPage"
             xmlns:material="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/material"
             xmlns:controls="clr-namespace:ConcertJournal.Views.Controls"
             xmlns:vm="clr-namespace:ConcertJournal.ViewModels"
             x:DataType="vm:SettingsViewModel"
             BackgroundColor="{DynamicResource Background}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Style TargetType="material:TextField">
                <Setter Property="FontSize" Value="15" />
                <Setter Property="TextColor" Value="{DynamicResource TextColor}" />
                <Setter Property="AccentColor" Value="{DynamicResource Primary}" />
                <Setter Property="TitleColor" Value="{DynamicResource Primary}" />
                <Setter Property="BorderColor" Value="{DynamicResource CardBorder}" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*,Auto">

        <VerticalStackLayout Grid.Row="0" Padding="20,15,20,10" BackgroundColor="{DynamicResource CardBackground}">
            <Label Text="Settings" FontSize="28" FontAttributes="Bold" TextColor="{DynamicResource Primary}" HorizontalOptions="Center"/>
            <Label Text="App preferences and data management" FontSize="12" Opacity="0.6" HorizontalOptions="Center"/>
        </VerticalStackLayout>

        <material:TabView Grid.Row="1" x:Name="SettingsTabView" TabPlacement="Top">

            <material:TabView.TabHeaderItemTemplate>
                <DataTemplate x:DataType="material:TabItem">
                    <Label Text="{Binding Title}" HorizontalTextAlignment="Center" VerticalTextAlignment="Center" FontSize="14" Padding="10,15">
                        <Label.Triggers>
                            <DataTrigger TargetType="Label" Binding="{Binding IsSelected}" Value="True">
                                <Setter Property="TextColor" Value="{DynamicResource Primary}" />
                                <Setter Property="FontAttributes" Value="Bold" />
                            </DataTrigger>
                        </Label.Triggers>
                    </Label>
                </DataTemplate>
            </material:TabView.TabHeaderItemTemplate>

            <material:TabItem Title="Interface">
                <material:TabItem.ContentTemplate>
                    <DataTemplate x:DataType="vm:SettingsViewModel">
                        <ScrollView Padding="20">
                            <Border BackgroundColor="{DynamicResource CardBackground}" Padding="20" StrokeShape="RoundRectangle 15">
                                <Grid ColumnDefinitions="*, Auto">
                                    <VerticalStackLayout VerticalOptions="Center">
                                        <Label Text="Dark Mode" FontSize="18" FontAttributes="Bold"/>
                                        <Label Text="Switch between light and dark themes" FontSize="12" Opacity="0.6"/>
                                    </VerticalStackLayout>
                                    <Switch Grid.Column="1" IsToggled="{Binding IsDevilTheme}" ThumbColor="{DynamicResource Primary}" OnColor="{DynamicResource Primary}" Opacity="0.8"/>
                                </Grid>
                            </Border>
                        </ScrollView>
                    </DataTemplate>
                </material:TabItem.ContentTemplate>
            </material:TabItem>

            <material:TabItem Title="Data">
                <material:TabItem.ContentTemplate>
                    <DataTemplate x:DataType="vm:SettingsViewModel">
                        <ScrollView Padding="20">
                            <VerticalStackLayout Spacing="15">
                                <Label Text="Backup &amp; Restore" FontSize="14" FontAttributes="Bold" Margin="5,0" Opacity="0.7"/>

                                <Border BackgroundColor="{DynamicResource CardBackground}" Padding="15" StrokeShape="RoundRectangle 15">
                                    <VerticalStackLayout Spacing="20">
                                        <Grid ColumnDefinitions="*, Auto">
                                            <VerticalStackLayout>
                                                <Label Text="Import Data" FontAttributes="Bold"/>
                                                <Label Text="Load concerts from Excel (.xlsx)" FontSize="12" Opacity="0.6"/>
                                            </VerticalStackLayout>
                                            <Button Grid.Column="1" Text="Import" Command="{Binding ImportDataCommand}" StyleClass="ElevatedButton" HeightRequest="40"/>
                                        </Grid>

                                        <BoxView HeightRequest="1" Color="{DynamicResource Background}" Opacity="0.5"/>

                                        <Grid ColumnDefinitions="*, Auto">
                                            <VerticalStackLayout>
                                                <Label Text="Export Data" FontAttributes="Bold"/>
                                                <Label Text="Save your journey to Excel" FontSize="12" Opacity="0.6"/>
                                            </VerticalStackLayout>
                                            <Button Grid.Column="1" Text="Export" Command="{Binding ExportDataCommand}" BackgroundColor="Transparent" BorderWidth="1" BorderColor="{DynamicResource Primary}" TextColor="{DynamicResource TextColor}" HeightRequest="40"/>
                                        </Grid>
                                    </VerticalStackLayout>
                                </Border>
                            </VerticalStackLayout>
                        </ScrollView>
                    </DataTemplate>
                </material:TabItem.ContentTemplate>
            </material:TabItem>

            <material:TabItem Title="Defaults">
                <material:TabItem.ContentTemplate>
                    <DataTemplate x:DataType="vm:SettingsViewModel">
                        <ScrollView Padding="20">
                            <VerticalStackLayout Spacing="20">
                                <Border BackgroundColor="{DynamicResource CardBackground}" Padding="20" StrokeShape="RoundRectangle 15">
                                    <VerticalStackLayout Spacing="20">
                                        <material:TextField Title="Home Country" 
                                                            Text="{Binding DefaultCountry}"/>

                                        <material:TextField Title="Home City" 
                                                            Text="{Binding DefaultCity}"/>
                                    </VerticalStackLayout>
                                </Border>

                                <Button Text="Save Default Preferences" 
                                        Command="{Binding SaveDefaultsCommand}"
                                        BackgroundColor="{DynamicResource Primary}"
                                        TextColor="White"
                                        FontAttributes="Bold"
                                        CornerRadius="25"
                                        HeightRequest="50"
                                        Margin="0,10"/>
                            </VerticalStackLayout>
                        </ScrollView>
                    </DataTemplate>
                </material:TabItem.ContentTemplate>
            </material:TabItem>
        </material:TabView>

        <controls:BottomNavBar Grid.Row="2" ActiveRoute="SettingsPage"/>
    </Grid>
</ContentPage>